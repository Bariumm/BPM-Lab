<!-- WebShopAsync BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Fri Nov 25 17:49:09 CET 2016 -->
<bpel:process name="WebShopAsync"
         targetNamespace="http://iaas.uni-stuttgart.de/labs/FlowSOG"
         suppressJoinFailure="yes"
         xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns1="http://www.w3.org/2001/XMLSchema">

    <!-- Import the client WSDL -->
    <bpel:import namespace="http://iaas.uni-stuttgart.de/labs/FlowSOG" location="FlowSOG.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import location="WebShopAsyncArtifacts.wsdl" namespace="http://iaas.uni-stuttgart.de/labs/FlowSOG" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
         
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!-- The 'client' role represents the requester of this service. -->
        <bpel:partnerLink name="client"
                     partnerLinkType="tns:WebShopAsync"
                     myRole="WebShopAsyncProvider"
                     />
        
        <bpel:partnerLink name="InventoryPL" partnerLinkType="tns:InventoryPLT" partnerRole="InventoryPLProvider" myRole="InventoryPLRequester"></bpel:partnerLink>
        <bpel:partnerLink name="OrderPL" partnerLinkType="tns:OrderPLT" partnerRole="OrderProvider"></bpel:partnerLink>
        <bpel:partnerLink name="ShipmentPL" partnerLinkType="tns:ShipmentPLT" partnerRole="ShipmentProvider"></bpel:partnerLink>
        <bpel:partnerLink name="PaymentPL" partnerLinkType="tns:PaymentPLT" partnerRole="PaymentProvider"></bpel:partnerLink>
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input"
                  messageType="tns:WebShopAsyncRequestMessage"/>
                  
        <!-- 
          Reference to the message that will be returned to the requester
          -->
        <bpel:variable name="output"
                  messageType="tns:WebShopAsyncResponseMessage"/>
        
        
        
        <bpel:variable name="InventoryPLRequest" messageType="tns:checkAvailabilityAsyncInput"></bpel:variable>
        <bpel:variable name="InventoryPLRequest1" messageType="tns:onFinishCheckAvailabilityInput"></bpel:variable>
        <bpel:variable name="OrderPLResponse" messageType="tns:storeOrderDetailsOutput"></bpel:variable>
        <bpel:variable name="OrderPLRequest" messageType="tns:storeOrderDetailsInput"></bpel:variable>
        <bpel:variable name="OrderPLResponse1" messageType="tns:calcOrderCostsOutput"></bpel:variable>
        <bpel:variable name="OrderPLRequest1" messageType="tns:calcOrderCostsInput"></bpel:variable>
        <bpel:variable name="ShipmentPLResponse" messageType="tns:calcShipmentCostsOutput"></bpel:variable>
        <bpel:variable name="ShipmentPLRequest" messageType="tns:calcShipmentCostsInput"></bpel:variable>
        <bpel:variable name="PaymentPLResponse" messageType="tns:calcTransactionCostsOutput"></bpel:variable>
        <bpel:variable name="PaymentPLRequest" messageType="tns:calcTransactionCostsInput"></bpel:variable>
        <bpel:variable name="PaymentPLResponse1" messageType="tns:conductPaymentOutput"></bpel:variable>
        <bpel:variable name="PaymentPLRequest1" messageType="tns:conductPaymentInput"></bpel:variable>
        <bpel:variable name="ShipmentPLResponse1" messageType="tns:shipProductsOutput"></bpel:variable>
        <bpel:variable name="ShipmentPLRequest1" messageType="tns:shipProductsInput"></bpel:variable>
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:correlationSets>
        <bpel:correlationSet name="CorrelationSet" properties="tns:Inventory"></bpel:correlationSet>
    </bpel:correlationSets>
    <bpel:sequence name="main">
        
        <!-- Receive input from requester. 
             Note: This maps to operation defined in WebShopAsync.wsdl 
             -->
        <bpel:receive name="receiveInput" partnerLink="client"
                 createInstance="yes" operation="process" portType="tns:WebShopAsync" variable="input"/>
        
        <!-- Generate reply to synchronous request -->
        
        <bpel:flow name="Flow1"><bpel:sequence name="sequenceCheckAvailability">
                <bpel:assign validate="no" name="assignToCheckAvailabilityAsync">
            
            
            
            
            
            
            
            
            
            
            
            
            
            <bpel:copy>
                <bpel:from><bpel:literal><tns:checkAvailabilityAsync xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:callbackUrl>tns:callbackUrl</tns:callbackUrl>
  <tns:customerId>tns:customerId</tns:customerId>
  <tns:productId>tns:productId</tns:productId>
</tns:checkAvailabilityAsync>
</bpel:literal></bpel:from>
                <bpel:to variable="InventoryPLRequest" part="checkAvailabilityAsyncInput"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:products[1]/tns:product[1]/tns:productID]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="checkAvailabilityAsyncInput" variable="InventoryPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:productId[1]]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerID]]></bpel:query>
                </bpel:from>
                <bpel:to part="checkAvailabilityAsyncInput" variable="InventoryPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerId]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callbackUrl]]></bpel:query>
                </bpel:from>
                <bpel:to part="checkAvailabilityAsyncInput" variable="InventoryPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callbackUrl]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
                <bpel:invoke name="checkAvailabilityAsync" partnerLink="InventoryPL" operation="checkAvailabilityAsync" portType="tns:InventoryPortType" inputVariable="InventoryPLRequest"><bpel:correlations>
                <bpel:correlation set="CorrelationSet" initiate="yes"></bpel:correlation>
            </bpel:correlations>
        
                </bpel:invoke>
                <bpel:receive name="receiveCallback" partnerLink="InventoryPL" operation="onFinishCheckAvailability" variable="InventoryPLRequest1"><bpel:correlations>
                <bpel:correlation set="CorrelationSet" initiate="no"></bpel:correlation>
            </bpel:correlations>
        
                </bpel:receive>
            </bpel:sequence><bpel:sequence name="sequenceCalcCosts">
                <bpel:assign validate="no" name="assignToStoreOrderDetails">
            <bpel:copy>
                <bpel:from><bpel:literal xml:space="preserve"><tns:storeOrderDetails xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:orderId></tns:orderId>
  <tns:customerId>tns:customerId</tns:customerId>
  <tns:products>
    <tns:product>
      <tns:productId>tns:productId</tns:productId>
      <tns:numberOfItems>0</tns:numberOfItems>
    </tns:product>
  </tns:products>
  <tns:shippingAddress>tns:shippingAddress</tns:shippingAddress>
  <tns:paymentDetails>
    <tns:bankName>tns:bankName</tns:bankName>
    <tns:bankAddress>tns:bankAddress</tns:bankAddress>
    <tns:accountNumber>tns:accountNumber</tns:accountNumber>
    <tns:accountHolderName>tns:accountHolderName</tns:accountHolderName>
  </tns:paymentDetails>
  <tns:status>ordered</tns:status>
</tns:storeOrderDetails>
</bpel:literal></bpel:from>
                <bpel:to variable="OrderPLRequest" part="storeOrderDetailsInput"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerID]]></bpel:query>
                </bpel:from>
                <bpel:to part="storeOrderDetailsInput" variable="OrderPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:customerId]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shippingAddress]]></bpel:query>
                </bpel:from>
                <bpel:to part="storeOrderDetailsInput" variable="OrderPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shippingAddress]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentDetails]]></bpel:query>
                </bpel:from>
                <bpel:to part="storeOrderDetailsInput" variable="OrderPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentDetails]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:products[1]/tns:product[1]/tns:productID]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="storeOrderDetailsInput" variable="OrderPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:products/tns:product[1]/tns:productId]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:products[1]/tns:product[1]/tns:numberOfItems]]></bpel:query>
                </bpel:from>
                <bpel:to part="storeOrderDetailsInput" variable="OrderPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:products/tns:product[1]/tns:numberOfItems]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
                <bpel:invoke name="storeOrderDetails" partnerLink="OrderPL" operation="storeOrderDetails" portType="tns:OrderPortType" inputVariable="OrderPLRequest" outputVariable="OrderPLResponse"></bpel:invoke>
                <bpel:flow name="Flow">
                    <bpel:sequence name="sequenceCalcOrderCosts"><bpel:assign validate="no" name="assignToCalcOrderCosts">
                    <bpel:copy>
                        <bpel:from><bpel:literal><tns:calcOrderCosts xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:orderId>tns:orderId</tns:orderId>
</tns:calcOrderCosts>
</bpel:literal></bpel:from>
                        <bpel:to variable="OrderPLRequest1" part="calcOrderCostsInput"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="storeOrderDetailsOutput" variable="OrderPLResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="calcOrderCostsInput" variable="OrderPLRequest1">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[tns:orderId]]>
                            </bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
                <bpel:invoke name="calcOrderCosts" partnerLink="OrderPL" operation="calcOrderCosts" portType="tns:OrderPortType" inputVariable="OrderPLRequest1" outputVariable="OrderPLResponse1"></bpel:invoke>
            
                    </bpel:sequence>
                    <bpel:sequence name="sequenceCalcShippingCosts">
                
                <bpel:assign validate="no" name="assignToCalcShippingCosts">
                    <bpel:copy>
                        <bpel:from><bpel:literal><tns:calcShipmentCosts xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:orderId>tns:orderId</tns:orderId>
</tns:calcShipmentCosts>
</bpel:literal></bpel:from>
                        <bpel:to variable="ShipmentPLRequest" part="calcShipmentCostsInput"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="storeOrderDetailsOutput" variable="OrderPLResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="calcShipmentCostsInput" variable="ShipmentPLRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
                <bpel:invoke name="calcShippingCosts" partnerLink="ShipmentPL" operation="calcShipmentCosts" portType="tns:ShipmentPortType" inputVariable="ShipmentPLRequest" outputVariable="ShipmentPLResponse"></bpel:invoke>
            </bpel:sequence>
                    <bpel:sequence name="sequenceCalcTransactionCosts">
                <bpel:assign validate="no" name="assignToCalcTransactionCosts">
                    <bpel:copy>
                        <bpel:from><bpel:literal><tns:calcTransactionCosts xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:orderId>tns:orderId</tns:orderId>
</tns:calcTransactionCosts>
</bpel:literal></bpel:from>
                        <bpel:to variable="PaymentPLRequest" part="calcTransactionCostsInput"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="storeOrderDetailsOutput" variable="OrderPLResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="calcTransactionCostsInput" variable="PaymentPLRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[tns:orderId]]>
                            </bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
                <bpel:invoke name="calcTransactionCosts" partnerLink="PaymentPL" operation="calcTransactionCosts" portType="tns:PaymentPortType" inputVariable="PaymentPLRequest" outputVariable="PaymentPLResponse"></bpel:invoke>
            </bpel:sequence>
                </bpel:flow>
                
                
                
                
            </bpel:sequence></bpel:flow>
        
        
        
        
        
        
        
        
        
        
        
        
        <bpel:if name="ifAvailable"><bpel:condition><![CDATA[count($InventoryPLRequest1.onFinishCheckAvailabilityInput/tns:productList/tns:product[tns:status/tns:currentAvailability != "available"]) = 0]]></bpel:condition>
                <bpel:sequence name="sequenceAvailable">
                    <bpel:assign validate="no" name="assignAllCostsToConductPayment"><bpel:copy>
                <bpel:from><bpel:literal><tns:conductPayment xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:orderId>tns:orderId</tns:orderId>
  <tns:amount>0.0</tns:amount>
</tns:conductPayment>
</bpel:literal></bpel:from>
                <bpel:to variable="PaymentPLRequest1" part="conductPaymentInput"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="storeOrderDetailsOutput" variable="OrderPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                </bpel:from>
                <bpel:to part="conductPaymentInput" variable="PaymentPLRequest1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <![CDATA[$OrderPLResponse1.calcOrderCostsOutput/tns:orderCosts + $PaymentPLResponse.calcTransactionCostsOutput/tns:transactionCosts + $ShipmentPLResponse.calcShipmentCostsOutput/tns:shipmentCosts]]>
                </bpel:from>
                <bpel:to part="conductPaymentInput" variable="PaymentPLRequest1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:amount]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
                </bpel:assign>
                    <bpel:invoke name="conductPayment" partnerLink="PaymentPL" operation="conductPayment" portType="tns:PaymentPortType" inputVariable="PaymentPLRequest1" outputVariable="PaymentPLResponse1"></bpel:invoke>
                    <bpel:assign validate="no" name="assignToShipProducts">
                        <bpel:copy><bpel:from><bpel:literal xml:space="preserve"><tns:shipProducts xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:orderId>tns:orderId</tns:orderId>
  <tns:date>2016-12-12</tns:date>
</tns:shipProducts>
</bpel:literal></bpel:from>
                <bpel:to variable="ShipmentPLRequest1" part="shipProductsInput"></bpel:to>
            
                        </bpel:copy><bpel:copy>
                <bpel:from part="storeOrderDetailsOutput" variable="OrderPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                </bpel:from>
                <bpel:to part="shipProductsInput" variable="ShipmentPLRequest1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
                
                    </bpel:assign>
                    <bpel:invoke name="shipProducts" partnerLink="ShipmentPL" operation="shipProducts" portType="tns:ShipmentPortType" inputVariable="ShipmentPLRequest1" outputVariable="ShipmentPLResponse1"></bpel:invoke>
                <bpel:assign validate="no" name="assignToOutput">
            
            
            
            
            
            
            
            
            
            
            
            <bpel:copy>
                <bpel:from><bpel:literal xml:space="preserve"><tns:WebShopAsyncResponse xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:customerID>tns:customerID</tns:customerID>
  <tns:orderID>tns:orderID</tns:orderID>
  <tns:shippingAddress>tns:shippingAddress</tns:shippingAddress>
  <tns:paymentDetails>
    <tns:bankName>tns:bankName</tns:bankName>
    <tns:bankAddress>tns:bankAddress</tns:bankAddress>
    <tns:accountNumber>tns:accountNumber</tns:accountNumber>
    <tns:accountHolderName>tns:accountHolderName</tns:accountHolderName>
  </tns:paymentDetails>
  <tns:costs>0.0</tns:costs>
  <tns:products>
    <tns:product>
      <tns:productID>tns:productID</tns:productID>
      <tns:numberOfItems>0</tns:numberOfItems>
    </tns:product>
  </tns:products>
  <tns:paymentStatus>tns:paymentStatus</tns:paymentStatus>
  <tns:shipmentStatus>tns:shipmentStatus</tns:shipmentStatus>
  <tns:availableStatus>Available</tns:availableStatus>
</tns:WebShopAsyncResponse></bpel:literal></bpel:from>
                <bpel:to variable="output" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerID]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerID]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="storeOrderDetailsOutput" variable="OrderPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderID]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shippingAddress]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shippingAddress]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentDetails]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentDetails]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:products[1]]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:products]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="conductPaymentOutput" variable="PaymentPLResponse1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentStatus]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="shipProductsOutput" variable="ShipmentPLResponse1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shipmentStatus]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            
            
            
        
                    <bpel:copy>
                        <bpel:from>
                            <![CDATA[$OrderPLResponse1.calcOrderCostsOutput/tns:orderCosts + $PaymentPLResponse.calcTransactionCostsOutput/tns:transactionCosts + $ShipmentPLResponse.calcShipmentCostsOutput/tns:shipmentCosts]]>
                        </bpel:from>
                        <bpel:to part="payload" variable="output">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:costs]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
                <bpel:reply name="replyOutput" partnerLink="client" operation="process" portType="tns:WebShopAsync" variable="output"/>
            </bpel:sequence>
                <bpel:else>
                    <bpel:sequence name="sequenceUnavailable">
                        <bpel:assign validate="no" name="assignError">
                            <bpel:copy>
                                <bpel:from><bpel:literal xml:space="preserve"><tns:WebShopAsyncResponse xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:customerID>tns:customerID</tns:customerID>
  <tns:orderID>tns:orderID</tns:orderID>
  <tns:shippingAddress>tns:shippingAddress</tns:shippingAddress>
  <tns:paymentDetails>
    <tns:bankName>tns:bankName</tns:bankName>
    <tns:bankAddress>tns:bankAddress</tns:bankAddress>
    <tns:accountNumber>tns:accountNumber</tns:accountNumber>
    <tns:accountHolderName>tns:accountHolderName</tns:accountHolderName>
  </tns:paymentDetails>
  <tns:status>Product is not available.</tns:status>
  <tns:costs>0.0</tns:costs>
  <tns:products>
    <tns:product>
      <tns:productID>tns:productID</tns:productID>
      <tns:numberOfItems>0</tns:numberOfItems>
    </tns:product>
  </tns:products>
</tns:WebShopAsyncResponse>
</bpel:literal></bpel:from>
                                <bpel:to variable="output" part="payload"></bpel:to>
                            </bpel:copy>
                            
                        <bpel:copy>
                            <bpel:from part="payload" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerID]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="payload" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerID]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="storeOrderDetailsOutput" variable="OrderPLResponse">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="payload" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderID]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="payload" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shippingAddress]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="payload" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shippingAddress]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="payload" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentDetails]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="payload" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentDetails]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                        
                        <bpel:copy>
                            <bpel:from>
                                <![CDATA[$OrderPLResponse1.calcOrderCostsOutput/tns:orderCosts + $PaymentPLResponse.calcTransactionCostsOutput/tns:transactionCosts + $ShipmentPLResponse.calcShipmentCostsOutput/tns:shipmentCosts]]>
                            </bpel:from>
                            <bpel:to part="payload" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:costs]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:reply name="replyOutput" partnerLink="client" operation="process" portType="tns:WebShopAsync" variable="output"></bpel:reply>
                </bpel:sequence>
                </bpel:else>
            
        </bpel:if>
        
        
        
    </bpel:sequence>
</bpel:process>

